
# Anti-Impersonation Telegram Bot

[![Deploy on Railway](https://railway.app/button.svg)](https://railway.app/template/telegram-bot)

A powerful bot to detect and ban user impersonators in Telegram groups.

## Features
- **Username Matching**: Detects similar usernames using fuzzy logic.
- **Display Name Matching**: Detects similar names.
- **Profile Picture Matching**: Detects identical or similar profile pictures using perceptual hashing (pHash).
- **Whitelist System**: Import all admins as trusted users.
- **Logging**: Logs all actions to a dedicated channel and database.

## Quick Deploy to Railway

### Prerequisites
- A Telegram bot token from [@BotFather](https://t.me/BotFather)
- A Telegram channel for logs (get the channel ID)
- A Railway account (free tier available)

### Deployment Steps

1. **Click the Deploy button** above or visit [Railway](https://railway.app)

2. **Create a new project** and add PostgreSQL:
   ```bash
   # Railway will automatically provision PostgreSQL
   # and set the DATABASE_URL environment variable
   ```

3. **Set environment variables** in Railway dashboard:
   - `BOT_TOKEN`: Your bot token from BotFather
   - `LOG_CHANNEL_ID`: Your log channel ID (e.g., -1001234567890)
   - `NAME_SIMILARITY_THRESHOLD`: 85 (default)
   - `PFP_HASH_THRESHOLD`: 10 (default)
   - `DATABASE_URL`: Auto-generated by Railway PostgreSQL

4. **Deploy from GitHub**:
   - Connect your GitHub repository
   - Railway will automatically deploy on push to main branch

5. **Verify deployment**:
   - Check Railway logs for "ðŸŸ¢ **Anti-Impersonator Bot Started**"
   - Send `/start` to your bot in Telegram

## Local Development Setup

1. **Install Dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

2. **Configure Environment**:
   - Copy `.env.example` to `.env`
   - Fill in `BOT_TOKEN` (from @BotFather)
   - Fill in `DATABASE_URL` (PostgreSQL connection string)
   - Fill in `LOG_CHANNEL_ID` (ID of the channel where logs should be sent)

3. **Run the Bot**:
   ```bash
   python run.py
   ```

## Commands

### Private Setup (Recommended)
1. Start a DM with your bot.
2. Send `/start`.
3. Click the **"Select Group to Setup"** button.
4. Choose your group from the list.
5. The bot will automatically import all admins.

### Group Commands
- `/start` - Check if bot is running.
- `/import_admins` - Add all current admins to the whitelist (Admin only).
- `/whitelist` (reply to a user) - Whitelist a specific user (Admin only).

> **Note**: Group commands must be run **in the group chat**, not in DMs with the bot.

## Important Notes

### Command Permissions
All commands (`/import_admins`, `/whitelist`) are **restricted to group administrators only**. Regular members cannot use these commands.

### Bot Persistence

**Local Development**: The bot must be kept running continuously. If you restart your computer or close the terminal:
- The bot will stop responding
- You need to run `python run.py` again to restart it

**Railway Deployment**: The bot runs 24/7 automatically with:
- Auto-restart on failure
- Persistent PostgreSQL database
- Automatic deployments from GitHub

### Automatic Scanning
The bot automatically scans **all new members** who join the group. No manual scanning is needed.

## Database

The bot uses PostgreSQL. It will automatically create tables `whitelisted_users` and `logs` on startup if they don't exist.
